{% extends 'base_usuario.html' %}
{% load static %}

{% block title %}Editar Actividad | {{ actividad.titulo }}{% endblock %}

{% block extra_css %}
<link href="{% static 'css/actividades.css' %}" rel="stylesheet">
<style>
    .form-label {
        font-weight: 600;
    }

    .btn-danger {
        transition: all 0.2s;
    }

    .btn-danger:hover {
        transform: scale(1.05);
    }
</style>
{% endblock %}

{% block usuario_content %}
<div class="container mt-5">
    <div class="card shadow p-4">
        <h2 class="text-center mb-4">‚öôÔ∏è Editar Actividad</h2>
        <p class="text-center text-muted">Modifica los detalles de la actividad "{{ actividad.titulo }}"</p>

        <!-- Informaci√≥n din√°mica de la actividad -->
        <div class="alert alert-info d-flex justify-content-between align-items-center">
            <div>
                <strong>Actividad actual:</strong> {{ actividad.titulo }}<br>
                <strong>Deporte:</strong> {{ actividad.deporte|capfirst }}<br>
                <strong>Participantes inscritos:</strong> {{ actividad.participantes.count }}
            </div>
            <a href="{% url 'gestionar_participantes' pk=actividad.pk %}" class="btn btn-info btn-sm">
                üë• Administrar Participantes
            </a>
        </div>

        <!-- Formulario de edici√≥n -->
        <form method="POST">
            {% csrf_token %}

            <!-- Campo T√≠tulo -->
            <div class="mb-3">
                <label for="titulo" class="form-label fw-semibold">T√≠tulo</label>
                <input type="text" id="titulo" name="titulo" class="form-control" value="{{ actividad.titulo }}"
                    required>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="deporte" class="form-label fw-semibold">Deporte</label>
                    <select id="deporte" name="deporte" class="form-select" required>
                        {% for d in deportes %}
                        <option value="{{ d }}" {% if d == actividad.deporte %}selected{% endif %}>{{ d|capfirst }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Campo de Ubicaci√≥n (sin Google Maps) -->
                <div class="col-md-4 mb-3">
                    <label for="lugar" class="form-label fw-semibold">Lugar</label>
                    <input type="text" name="lugar" class="form-control" value="{{ actividad.lugar }}"
                        placeholder="Ej: Cancha Municipal, Parque Central" required>
                    <small class="form-text text-muted">Ingresa el nombre del lugar</small>
                </div>

                <div class="col-md-2 mb-3">
                    <label for="fecha" class="form-label fw-semibold">Fecha</label>
                    <input type="date" id="fecha" name="fecha" class="form-control"
                        value="{{ actividad.fecha|date:'Y-m-d' }}" required>
                </div>

                <!-- Hora de Inicio -->
                <div class="col-md-2 mb-3">
                    <label for="hora_inicio" class="form-label fw-semibold">Hora Inicio</label>
                    <input type="time" id="hora_inicio" name="hora_inicio" class="form-control"
                        value="{{ actividad.hora_inicio|time:'H:i' }}" required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="hora_fin" class="form-label fw-semibold">Hora Fin (Opcional)</label>
                    <input type="time" id="hora_fin" name="hora_fin" class="form-control"
                        value="{{ actividad.hora_fin|time:'H:i' }}">
                </div>

                <div class="col-md-4 mb-3">
                    <label for="cupos" class="form-label fw-semibold">Cupos disponibles</label>
                    <input type="number" id="cupos" name="cupos" class="form-control"
                        min="{{ actividad.participantes.count }}" max="50" value="{{ actividad.cupos }}" required>
                    <small class="form-text text-muted">M√≠nimo: {{ actividad.participantes.count }} (participantes
                        actuales)</small>
                </div>

                <div class="col-md-4 mb-3">
                    <label for="nivel" class="form-label fw-semibold">Nivel</label>
                    <select id="nivel" name="nivel" class="form-select" required>
                        <option value="Principiante" {% if actividad.nivel ==  'Principiante' %}selected{% endif %}>
                            Principiante</option>
                        <option value="Intermedio" {% if actividad.nivel == 'Intermedio' %}selected{% endif %}>Intermedio
                        </option>
                        <option value="Avanzado" {% if actividad.nivel == 'Avanzado' %}selected{% endif %}>Avanzado
                        </option>
                    </select>
                </div>
            </div>

            <div class="mb-3">
                <label for="descripcion" class="form-label fw-semibold">Descripci√≥n</label>
                <textarea id="descripcion" name="descripcion" class="form-control"
                    rows="3">{{ actividad.descripcion }}</textarea>
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-between mt-4">
                <a href="{% url 'mis_actividades' %}" class="btn btn-outline-secondary">‚¨Ö Volver</a>
                <div>
                    <button type="submit" class="btn btn-primary me-2">üíæ Guardar cambios</button>
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#cancelModal">‚ùå
                        Cancelar actividad</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal de confirmaci√≥n de cancelaci√≥n -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="cancelModalLabel">Confirmar cancelaci√≥n</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <p>¬øEst√°s seguro de que deseas cancelar esta actividad?</p>
                <p class="text-muted">Esta acci√≥n no se puede deshacer y notificar√° a todos los participantes inscritos.
                </p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Volver</button>
                <a href="{% url 'cancelar_actividad' pk=actividad.pk %}" class="btn btn-danger">S√≠, cancelar</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}